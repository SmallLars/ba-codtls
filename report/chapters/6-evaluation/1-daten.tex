\section{Datenverkehr während des Handshakes}

Verglichen werden 3 Verfahren bei benutzung des definierten ciphersuits.
\begin{itemize}
  \item Neu
  \item DTLS original
  \item DTLS mit stateless header compression
\end{itemize}
dazu werden in den folgenden 3 abschnitten die datenmengen ermittelt, während in 4 abschnitt der vergleich erfolgt.
dabei wird ein handshake ohne datenverluste oder andere fehler und angriffe betrachtet.

je nach umfeld anders aber dort jeweils konstant:
\begin{itemize}
  \item 802.15.4 Header - Bietet 127 Byte Payload
  \item 48 Byte - 6LowPAN Header
  \item 08 Byte - UDP Header
\end{itemize}
deswegen werden diese nur im sinne von anzahl der pakete betrachtet

Folgende werden verwendet und sind bei allen 3 Verfahren gleich:\\
\begin{figure}[!ht]
\centering
\begin{tabular}{l|r}
  \hiderowcolors
  Typ & Größe\\
  \hline
  ClientHello ohne Cookie & 57 Byte\\
  HelloVerifyRequest      & 11 Byte\\
  ClientHello mit Cookie  & 65 Byte\\
  ServerHello             & 56 Byte\\
  ServerKeyExchange       & 87 Byte\\
  ServerHelloDone         &  0 Byte\\
  ClientKeyExchange       & 87 Byte\\
  ChangeCipherSpec        &  1 Byte\\
  Finished                & 12 Byte\\
  \showrowcolors
\end{tabular}
\caption{Größe der Handshake Nachrichten}
\label{tbl:6-1_handshake-data}
\end{figure}


darauf basierend werden nun die Datenmengen für alle 3 Verfahren ermittelt\\
ausgangssituation ist epoche 0 mit verwendetem ciphersuit

\subsection{Neu}

gemäß abbildung 3.2

coap packete die nur zur bestätigung dienen und keine daten enthalten rausrechnen zum zusätzlichen vergleich

in kapitel 3.2 hat sich blockgröße von 32 byte ergeben die hier herangezogen wird

\begin{figure}[!ht]
\centering
\begin{tabular}{r|c|r|r|r|r|l}
  \hiderowcolors
  Nr. & <-> & \rotatebox{90}{DTLS-Record-Header} & \rotatebox{90}{CoAP-Header} & \rotatebox{90}{DTLS-Content-Header} & \rotatebox{90}{DTLS-Handshake-Daten} & CoAP-Optionen und Inhalt\\
  \hline
  \hline
   1 & --> & 3 & 13 & 2 & 30 & URI, B1, CHello ohne Cookie [1/2]\\
   2 & <-- & 3 &  7 &   &    & B1\\
   3 & --> & 3 & 13 &   & 27 & URI, B1, CHello ohne Cookie [2/2]\\
   4 & <-- & 3 & 10 & 2 & 11 & CT, B1, HelloVerifyRequest\\
  \hline
  \hline
   5 & --> & 3 & 13 & 2 & 30 & URI, B1, CHello mit Cookie [1/3]\\
   6 & <-- & 3 &  7 &   &    & B1\\
   7 & --> & 3 & 13 &   & 32 & URI, B1, CHello mit Cookie [2/3]\\
   8 & <-- & 3 &  7 &   &    & B1\\
   9 & --> & 3 & 13 &   &  3 & URI, B1, CHello mit Cookie [3/3]\\
  10 & <-- & 3 &  4 &   &    & EMPTY (Separate Antwort)\\
  11 & <-- & 3 & 11 & 5 & 27 & CT, B1, B2, SHello, SKeyExchange, SHelloDone [1/5]\\
  12 & --> & 3 &  4 &   &    & EMPTY\\
  13 & <-- & 3 &  9 &   & 32 & CT, B2, SHello, SKeyExchange, SHelloDone [2/5]\\
  14 & --> & 3 &  4 &   &    & EMPTY\\
  15 & <-- & 3 &  9 &   & 32 & CT, B2, SHello, SKeyExchange, SHelloDone [3/5]\\
  16 & --> & 3 &  4 &   &    & EMPTY\\
  17 & <-- & 3 &  9 &   & 32 & CT, B2, SHello, SKeyExchange, SHelloDone [4/5]\\
  18 & --> & 3 &  4 &   &    & EMPTY\\
  19 & <-- & 3 &  9 &   & 20 & CT, B2, SHello, SKeyExchange, SHelloDone [5/5]\\
  20 & --> & 3 &  4 &   &    & EMPTY\\
  \hline
  \hline
  21 & --> & 3 & 22 & 6 & 26 & URI, B1, CKeyExchange, ChangeCipherSpec, Finished [1/4]\\
  22 & <-- & 3 &  7 &   &    & B1\\
  23 & --> & 3 & 22 &   & 32 & URI, B1, CKeyExchange, ChangeCipherSpec, Finished [2/4]\\
  24 & <-- & 3 &  7 &   &    & B1\\
  25 & --> & 3 & 22 &   & 32 & URI, B1, CKeyExchange, ChangeCipherSpec, Finished [3/4]\\
  26 & <-- & 3 &  7 &   &    & B1\\
  27 & --> & 3 & 22 &   & 18 & URI, B1, CKeyExchange, ChangeCipherSpec, Finished [4/4]\\
  28 & <-- & 3 &  4 &   &    & EMPTY (Separate Antwort)\\
  29 & <-- & 3 & 10 & 4 & 21 & CT, B1, ChangeCipherSpec, Finished\\
  30 & --> & 3 &  4 &   &    & EMPTY\\
  \hline
  \hline
    & <-> & 90 & 294 & 21 & 405 & Gesamt 810 \\
  \showrowcolors
\end{tabular}
\caption{Datenaustausch während eines Handshake mit angepasstem DTLS}
\label{tbl:6-1_data-dtls-neu}
\end{figure}

zu beachten ist, dass 14 Datenpakete mit 116 Byte coap spezifisch sind und keinerlei dtls handshake daten enthalten\\
die müssen zwar berücksichtig werden, sind aber dennoch eine separate betrachtung wert.\\

\subsection{DTLS original}

maximale payload größe: 127 - 48 - 8 - 13 - 12 - 8 = 38

\begin{figure}[!ht]
\centering
\begin{tabular}{r|c|r|r|r|l}
  \hiderowcolors
  Nr. & <-> & \rotatebox{90}{DTLS-Record-Header} & \rotatebox{90}{DTLS-Content-Header} & \rotatebox{90}{DTLS-Handshake-Daten} & Inhalt\\
  \hline
  \hline
   1 & --> & 13 & 12 & 38 & CHello ohne Cookie [1/2]\\
   2 & --> & 13 & 12 & 19 & CHello ohne Cookie [2/2]\\
   3 & <-- & 13 & 12 & 11 & HelloVerifyRequest\\
  \hline
  \hline
   4 & --> & 13 & 12 & 38 & CHello mit Cookie [1/2]\\
   5 & --> & 13 & 12 & 27 & CHello mit Cookie [2/2]\\
   6 & <-- & 13 & 12 & 38 & SHello [1/2]\\
   7 & <-- & 13 & 12 & 18 & SHello [2/2]\\
   8 & <-- & 13 & 12 & 38 & SKeyExchange [1/3]\\
   9 & <-- & 13 & 12 & 38 & SKeyExchange [2/3]\\
  10 & <-- & 13 & 12 & 11 & SKeyExchange [3/3]\\
  11 & <-- & 13 & 12 &  0 & SHelloDone\\
  \hline
  \hline
  12 & --> & 13 & 12 & 38 & CKeyExchange [1/3]\\
  13 & --> & 13 & 12 & 38 & CKeyExchange [2/3]\\
  14 & --> & 13 & 12 & 11 & CKeyExchange [3/3]\\
  15 & --> & 13 & 12 &  1 & ChangeCipherSpec\\
  16 & --> & 13 & 12 & 20 & Finished inklusive 8 Byte MAC\\
  17 & <-- & 13 & 12 &  1 & ChangeCipherSpec\\
  18 & <-- & 13 & 12 & 20 & Finished inklusive 8 Byte MAC\\
  \hline
  \hline
    & <-> & 234 & 216 & 405 & Gesamt 861\\
  \showrowcolors
\end{tabular}
\caption{Datenaustausch während eines Handshake mit DTLS}
\label{tbl:6-1_data-dtls}
\end{figure}

\subsection{DTLS mit stateless header compression}

mit direkter umsetzung von draft \cite[Kapitel 3]{draftcodtls}

da die angepasste version einen maximalen dtls header ermöglicht, wird hier ebenfalls davon ausgegangen:\\
maximale payload größe: 127 - 48 - 8 - 15 - 14 - 8 = 34

\begin{figure}[!ht]
\centering
\begin{tabular}{r|c|r|r|r|l}
  \hiderowcolors
  Nr. & <-> & \rotatebox{90}{DTLS-Record-Header} & \rotatebox{90}{DTLS-Content-Header} & \rotatebox{90}{DTLS-Handshake-Daten} & Inhalt\\
  \hline
  \hline
   1 & --> & 3 & 4 & 34 & CHello ohne Cookie [1/2]\\
   2 & --> & 3 & 4 & 23 & CHello ohne Cookie [2/2]\\
   3 & <-- & 3 & 2 & 11 & HelloVerifyRequest\\
  \hline
  \hline
   4 & --> & 3 & 4 & 34 & CHello mit Cookie [1/2]\\
   5 & --> & 3 & 4 & 31 & CHello mit Cookie [2/2]\\
   6 & <-- & 3 & 4 & 34 & SHello [1/2]\\
   7 & <-- & 3 & 4 & 22 & SHello [2/2]\\
   8 & <-- & 3 & 4 & 34 & SKeyExchange [1/3]\\
   9 & <-- & 3 & 4 & 34 & SKeyExchange [2/3]\\
  10 & <-- & 3 & 4 & 19 & SKeyExchange [3/3]\\
  11 & <-- & 3 & 2 &  0 & SHelloDone\\
  \hline
  \hline
  12 & --> & 3 & 4 & 34 & CKeyExchange [1/3]\\
  13 & --> & 3 & 4 & 34 & CKeyExchange [2/3]\\
  14 & --> & 3 & 4 & 19 & CKeyExchange [3/3]\\
  15 & --> & 3 & 2 &  1 & ChangeCipherSpec\\
  16 & --> & 3 & 2 & 20 & Finished inklusive 8 Byte MAC\\
  17 & <-- & 3 & 2 &  1 & ChangeCipherSpec\\
  18 & <-- & 3 & 2 & 20 & Finished inklusive 8 Byte MAC\\
  \hline
  \hline
    & <-> & 54 & 60 & 405 & Gesamt 519\\
  \showrowcolors
\end{tabular}
\caption{Datenaustausch während eines Handshake mit DTLS und stateless header compression}
\label{tbl:6-1_data-dtls-comp}
\end{figure}

\subsection{Vergleich}

tada